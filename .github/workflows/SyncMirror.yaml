name: 'Sync Mirror'

on:
  push:
    branches: [ 'main', 'release/*' ]

permissions:
  actions: read
  contents: write
  packages: write

defaults:
  run:
    shell: powershell


jobs:
  GetBranches:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          repository: aholstrup1/AlAppExtensions-Mirror
          token: ${{ secrets.PAT }}

      - name: Pull Changes from upstream
        id: Sync
        run : |
          $Branch = $ENV:GITHUB_REFNAME

          Write-Host "Adding upstream"
          $repo = "https://github.com/aholstrup1/ALAppExtensions.git"
          git remote add upstream $repo
          git remote

          git fetch --all --prune

          Write-Host "Checking out $Branch"

          git checkout $Branch
          git pull upstream $Branch

          Write-Host "Pushing $Branch to upstream"

          git push origin $Branch